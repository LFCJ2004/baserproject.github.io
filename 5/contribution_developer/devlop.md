# 開発手順

ここでは、baserCMSコアの開発手順について説明します。

## 1. レポジトリをフォークする
baserCMSプロジェクトに GitHub コラボレーターとして登録されていない場合は、 コントリビューターとして一旦、自分の GitHub プロジェクトにフォークしてから開発にとりかかります。 

ブラウザで、[baserCMSのGitHub](https://github.com/baserproject/basercms/) を開き、ページ右上の「Fork」ボタンをクリックし、  
baserCMS のレポジトリをフォークします。（自分のプロジェクトに baserCMS レポジトリのコピーを作成します）

## 2. レポジトリをクローンする
ローカルにフォークしたレポジトリのクローンを作成します。

```
git clone git@github.com:{ユーザー名}/basercms.git {フォルダ名}
```

## 3. 開発ブランチの作成

リモートのブランチをローカルのブランチとしてコピーします。  
次のコマンドでリモートブランチをローカルブランチとしてコピーした上で、チェックアウトします。  

```shell
git checkout -b {ローカルブランチ名} remotes/origin/{リモートのブランチ名}

#（例）開発ブランチ dev-5 をローカルの開発ブランチ dev-5 としてコピー＆チェックアウト
git checkout -b dev-5 remotes/origin/dev-5
```
これで開発の準備が整いました。

## 4. Issueを立てる
baserCMSの開発は、[Issue駆動開発](../collaborator/issue_driven.md) を前提としています。まずは、開発する内容について、Issueを立ててください。  
既存のIssueに取り掛かる場合は、その旨、Issueにコメントを追加してください。

なお、公式開発メンバーの場合は、[ラベル運用ガイドライン](../collaborator/label_operation.md)に従って、ラベルを付与してください。


## 5. トピックブランチで開発＆コミット

開発を行う場合は、ローカルの開発ブランチからさらにトピックブランチを作成した上で取り掛かります。

baserCMSは、基本的にIssue駆動開発の為、トピックブランチの名称には、Issue番号を含める事をおすすめします。

また、トピックブランチからさらに作業用ブランチを作成し、そちらで開発し、開発が完了した時点でトピックブランチに `squash` オプション付きでマージする流れにすると、開発中に安心して随時コミットができ、不要なコミットログを残さなくてすみます。

```shell
# （例）バグチケットNO 3333 用のブランチを作成し改修する場合**
git checkout -b dev-#3333  
git checkout -b dev-#3333-work  
# 修正作業…  
git commit -a -m “◯◯を調整”  
git commit -a -m “◯◯を調整中、一旦コミット”  
git checkout dev-#3333  
git merge —squash dev-#3333-work
git commit -a -m “◯◯の不具合を修正 fix #3333”
```

※ マージの際に、「—squash」オプションを利用すると、マージした内容をコミットせず、変更だけを取り込む事ができます。  
これにより、作業用ブランチでコミットした際のメッセージをリモートブランチに含めず、マージしたタイミングでのメッセージだけをリモートブランチに送る事ができます。  

※ マージしたタイミングでのメッセージに、「fix #チケットNO」という内容を含めると、GitHubのIssueと連携させる事ができますので必ず入れるようにしましょう。  
具体的には、Issue詳細ページに、コミットへのリンクが張られます。

## 6. リモートにプッシュ

ローカルでの開発が完了したら、リモートのフォークレポジトリに変更内容を送信します。

``

```shell
git push {自身のレポジトリのリモート名} {トピックブランチ名}
# （例）フォークしたブランチ dev-#3333 を送信
git push origin dev-#3333
```

## 7. 本家にプルリクエストを送る
あなたが修正したプログラムコードをbaserCMSの本家レポジトリに反映させるには、baserCMSの本家レポジトリにプルリクエストを送る必要があります。  
ブラウザで、フォークしたbaserCMSのレポジトリページを開きます。  
https://github.com/{ユーザー名}/basercms

ページ右上の「Pull Request」ボタンをクリックします。  
内容を確認し問題なければ、どのような変更を行ったのかをメッセージ欄に入力し、「Send」ボタンを押すと、プルリクエストが送信され、リードデベロッパーにメールが送信されます。  
※ ここでプルリクエストの申請先ブランチが master に設定されている場合は、開発ブランチ（dev-x）に設定しなおしてください。

## 8. 本家にマージする

リードデベロッパーがコードレビューを行い問題がなければ、あなたの変更内容をbaserCMSの本家レポジトリに反映させます。  
その際、コミットメッセージに fix を記載している場合、Issueにも自動連携しクローズします。

## 9. 本家の変更内容を取り込む

あなたが開発している間に、baserCMSの本家レポジトリには、他の方の変更が取り込まれていきます。それらの変更を取り込むためには、baserCMSの本家レポジトリを事前にリモートとして設定しておく必要があります。  
※ こちらに直接プッシュできるのは、公式GitHubコラボレーターだけですので、プッシュは行えず、プルのみが可能となります。

### リモートを追加
```shell
git remote add {リモート名} git@github.com:basercms/basercms.git
# （例）リモート名 basercms として追加する
git remote add basercms git@github.com:basercms/basercms.git
```

### リモートの変更内容を取り込む
```shell
git pull {リモート名} {開発ブランチ名}
#（例）リモート名 basercms から、dev-3 ブランチの内容を取り込む
git pull basercms dev-5
```
これで次の開発を行う準備が整いました。

## 更に貢献したい場合は
あなたが、baserCMSコアの開発に更に貢献したい場合は、公式開発メンバーとして参加を希望することができます。

[開発への参加方法](./participation.md) をご覧ください。